"use strict";
(self["webpackChunkwebpack_demo"] = self["webpackChunkwebpack_demo"] || []).push([["index"],{

/***/ "./node_modules/css-loader/dist/cjs.js!./src/style.css":
/*!*************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/style.css ***!
  \*************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/cssWithMappingToString.js */ "./node_modules/css-loader/dist/runtime/cssWithMappingToString.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);
// Imports


var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default()));
// Module
___CSS_LOADER_EXPORT___.push([module.id, "html,\nbody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n  overflow: hidden;\n}\ncanvas {\n  width: 100%;\n  height: 100%;\n}\n.number {\n  position: fixed;\n  top: 10%;\n  left: 50%;\n  transform: translateX(-50%);\n}\n.tip {\n  position: fixed;\n  bottom: 20px;\n  left: 20px;\n  color: #333;\n}\n", "",{"version":3,"sources":["webpack://./src/style.css"],"names":[],"mappings":"AAAA;;EAEE,SAAS;EACT,UAAU;EACV,YAAY;EACZ,gBAAgB;AAClB;AACA;EACE,WAAW;EACX,YAAY;AACd;AACA;EACE,eAAe;EACf,QAAQ;EACR,SAAS;EACT,2BAA2B;AAC7B;AACA;EACE,eAAe;EACf,YAAY;EACZ,UAAU;EACV,WAAW;AACb","sourcesContent":["html,\nbody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n  overflow: hidden;\n}\ncanvas {\n  width: 100%;\n  height: 100%;\n}\n.number {\n  position: fixed;\n  top: 10%;\n  left: 50%;\n  transform: translateX(-50%);\n}\n.tip {\n  position: fixed;\n  bottom: 20px;\n  left: 20px;\n  color: #333;\n}\n"],"sourceRoot":""}]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ "./src/Flamingo.glb":
/*!**************************!*\
  !*** ./src/Flamingo.glb ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "e65cf9438e4210a07dcd6d841ee1f456.glb");

/***/ }),

/***/ "./src/style.css":
/*!***********************!*\
  !*** ./src/style.css ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleDomAPI.js */ "./node_modules/style-loader/dist/runtime/styleDomAPI.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertBySelector.js */ "./node_modules/style-loader/dist/runtime/insertBySelector.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js */ "./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertStyleElement.js */ "./node_modules/style-loader/dist/runtime/insertStyleElement.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleTagTransform.js */ "./node_modules/style-loader/dist/runtime/styleTagTransform.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./style.css */ "./node_modules/css-loader/dist/cjs.js!./src/style.css");

      
      
      
      
      
      
      
      
      

var options = {};

options.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());
options.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default());

      options.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, "head");
    
options.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());
options.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());

var update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__.default, options);




       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__.default && _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__.default.locals ? _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__.default.locals : undefined);


/***/ }),

/***/ "./src/components/direction.js":
/*!*************************************!*\
  !*** ./src/components/direction.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Direction)
/* harmony export */ });
function Direction() {
  let lastKey = null,
    lastUpTime = 0;
  let direction = {
    left: false,
    front: false,
    back: false,
    right: false,
    shift: false,
    doubleKey: '',
    value() {
      if (this.left && this.front) return 'LeftFront';
      if (this.left && this.back) return 'LeftBack';
      if (this.right && this.front) return 'RightFront';
      if (this.right && this.back) return 'RightBack';
      if (this.left) return 'Left';
      if (this.front) return 'Front';
      if (this.back) return 'Back';
      if (this.right) return 'Right';
      return 'Stop';
    },
  };

  document.addEventListener('keydown', function (ev) {
    if (lastKey === ev.code && new Date().getTime() - lastUpTime < 300) {
      direction.doubleKey = ev.code;
    }
    switch (ev.code) {
      case 'KeyA':
        direction.left = true;
        break;
      case 'KeyW':
        direction.front = true;
        break;
      case 'KeyD':
        direction.right = true;
        break;
      case 'KeyS':
        direction.back = true;
        break;
      case 'ShiftLeft':
        direction.shift = true;
        break;
    }
  });

  document.addEventListener('keyup', function (ev) {
    if (direction.doubleKey === ev.code) direction.doubleKey = '';
    lastKey = ev.code;
    lastUpTime = new Date().getTime();
    switch (ev.code) {
      case 'KeyA':
        direction.left = false;
        break;
      case 'KeyW':
        direction.front = false;
        break;
      case 'KeyD':
        direction.right = false;
        break;
      case 'KeyS':
        direction.back = false;
        break;
      case 'ShiftLeft':
        direction.shift = false;
        break;
    }
    return false;
  });

  return direction;
}


/***/ }),

/***/ "./src/components/util.js":
/*!********************************!*\
  !*** ./src/components/util.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "getRandom": () => (/* binding */ getRandom)
/* harmony export */ });
function getRandom(num1, num2) {
  let num = num2 - num1;
  return num1 + Math.round(num * Math.random());
}



/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! three */ "./node_modules/three/build/three.module.js");
/* harmony import */ var _style_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./style.css */ "./src/style.css");
/* harmony import */ var three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! three/examples/jsm/controls/OrbitControls.js */ "./node_modules/three/examples/jsm/controls/OrbitControls.js");
/* harmony import */ var three_examples_jsm_controls_PointerLockControls_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! three/examples/jsm/controls/PointerLockControls.js */ "./node_modules/three/examples/jsm/controls/PointerLockControls.js");
/* harmony import */ var dat_gui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! dat.gui */ "./node_modules/dat.gui/build/dat.gui.module.js");
/* harmony import */ var three_examples_jsm_libs_stats_module_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! three/examples/jsm/libs/stats.module.js */ "./node_modules/three/examples/jsm/libs/stats.module.js");
/* harmony import */ var _Flamingo_glb__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Flamingo.glb */ "./src/Flamingo.glb");
/* harmony import */ var three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! three/examples/jsm/loaders/GLTFLoader.js */ "./node_modules/three/examples/jsm/loaders/GLTFLoader.js");
/* harmony import */ var _components_direction__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./components/direction */ "./src/components/direction.js");
/* harmony import */ var _img_ground_jpg__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./img/ground.jpg */ "./src/img/ground.jpg");
/* harmony import */ var _img_blue_jpg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./img/blue.jpg */ "./src/img/blue.jpg");
/* harmony import */ var _img_sand_jpg__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./img/sand.jpg */ "./src/img/sand.jpg");
/* harmony import */ var _components_util__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./components/util */ "./src/components/util.js");















function main() {
  const textureLoader = new three__WEBPACK_IMPORTED_MODULE_13__.TextureLoader(); //图片渲染器
  const obstacle = []; //障碍物列表
  let direction = (0,_components_direction__WEBPACK_IMPORTED_MODULE_8__.default)(); //方向
  let container, //div容器
    controls, //div容器
    stats, //fps指示器
    clock, //时钟
    mixer, //动画混合器
    actions, //行为
    activeAction, //活动中行为
    previousAction; //上一个行为
  let camera, //相机
    scene, // 场景
    renderer, // 渲染器
    model, // 机器人模块
    groundList = [],
    boxList = [],
    boneList = [],
    speed = 1,
    fly_length = 0,
    fly_length_dom = 0,
    game_over = false;

  const directionObj = {
    Left: [0, (Math.PI * 5) / 4, -Math.PI / 4],
    LeftBack: [-Math.PI / 8, (Math.PI * 5) / 4, -Math.PI / 4],
    Back: [-Math.PI / 8, Math.PI, 0],
    RightBack: [-Math.PI / 8, (Math.PI * 3) / 4, Math.PI / 4],
    Right: [0, (Math.PI * 3) / 4, Math.PI / 4],
    RightFront: [Math.PI / 8, (Math.PI * 3) / 4, Math.PI / 4],
    Front: [Math.PI / 8, Math.PI, 0],
    LeftFront: [Math.PI / 8, (Math.PI * 5) / 4, -Math.PI / 4],
    Stop: [0, Math.PI, 0],
  };
  let RobotPositon = { x: 0, y: 0, z: 0 };

  let faceTo = 'Stop';

  init();
  animate();

  function init() {
    //创建div
    container = document.createElement('div');
    document.body.appendChild(container);

    //展示飞行距离
    fly_length_dom = document.createElement('div');
    fly_length_dom.setAttribute('class', 'number');
    container.appendChild(fly_length_dom);

    //提示
    const operation_tip = document.createElement('div');
    operation_tip.setAttribute('class', 'tip');
    operation_tip.innerText = '提示："W","A","S","D" 可操作方向';
    container.appendChild(operation_tip);

    //创建相机
    camera = new three__WEBPACK_IMPORTED_MODULE_13__.PerspectiveCamera(
      45,
      window.innerWidth / window.innerHeight,
      0.25,
      1000
    );
    camera.position.set(0, 50, 100);
    camera.lookAt(new three__WEBPACK_IMPORTED_MODULE_13__.Vector3(0, 300, 0));

    //创建场景
    scene = new three__WEBPACK_IMPORTED_MODULE_13__.Scene();
    scene.background = new three__WEBPACK_IMPORTED_MODULE_13__.Color(0xe0e0e0);
    //创建雾
    scene.fog = new three__WEBPACK_IMPORTED_MODULE_13__.Fog(0xe0e0e0, 10, 800);
    //时间
    clock = new three__WEBPACK_IMPORTED_MODULE_13__.Clock();

    //天空地面光
    const hemiLight = new three__WEBPACK_IMPORTED_MODULE_13__.HemisphereLight(0xffffff, 0x91d5ff, 1);
    scene.add(hemiLight);

    //方向光
    const dirLight = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0xffffff);
    dirLight.position.set(0, 200, 100);
    scene.add(dirLight);

    // ground

    const groundTexture = textureLoader.load(_img_ground_jpg__WEBPACK_IMPORTED_MODULE_9__);

    groundTexture.wrapS = three__WEBPACK_IMPORTED_MODULE_13__.MirroredRepeatWrapping;
    groundTexture.wrapT = three__WEBPACK_IMPORTED_MODULE_13__.MirroredRepeatWrapping;
    groundTexture.repeat.set(3, 7);

    const ground_material = new three__WEBPACK_IMPORTED_MODULE_13__.MeshLambertMaterial({
      map: groundTexture,
      color: 0x0050b3,
    });

    const blue_material = new three__WEBPACK_IMPORTED_MODULE_13__.MeshLambertMaterial({
      map: textureLoader.load(_img_blue_jpg__WEBPACK_IMPORTED_MODULE_10__),
      color: 0x0050b3,
    });

    const sand_material = new three__WEBPACK_IMPORTED_MODULE_13__.MeshLambertMaterial({
      map: textureLoader.load(_img_sand_jpg__WEBPACK_IMPORTED_MODULE_11__),
    });

    groundList.push(newBox(2000, 1, 2000, ground_material, 0, -100, -10));
    groundList.push(newBox(2000, 1, 2000, ground_material, 0, -100, -2010));

    for (let i = 0; i < 20; i++) {
      boxList.push(
        newBox(
          10,
          10,
          10,
          blue_material,
          (0,_components_util__WEBPACK_IMPORTED_MODULE_12__.getRandom)(-60, 60),
          (0,_components_util__WEBPACK_IMPORTED_MODULE_12__.getRandom)(-30, 30),
          1000 - 100 * i - Math.random(0, 100)
        )
      );
    }

    for (let i = 0; i < 10; i++) {
      boneList.push(
        newBox(
          10,
          10,
          10,
          sand_material,
          (0,_components_util__WEBPACK_IMPORTED_MODULE_12__.getRandom)(-60, 60),
          (0,_components_util__WEBPACK_IMPORTED_MODULE_12__.getRandom)(-30, 30),
          1000 - 200 * i - Math.random(0, 100)
        )
      );
    }

    function newBox(width, height, length, material, x, y, z) {
      const box = new three__WEBPACK_IMPORTED_MODULE_13__.Mesh(
        new three__WEBPACK_IMPORTED_MODULE_13__.BoxGeometry(width, height, length),
        material
      );
      box.position.set(x, y, z);
      scene.add(box);
      obstacle.push(box);
      return box;
    }

    const loader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_7__.GLTFLoader();

    loader.load(
      _Flamingo_glb__WEBPACK_IMPORTED_MODULE_6__.default,
      function (gltf) {
        const mesh = gltf.scene.children[0];

        const s = 0.1;
        mesh.scale.set(s, s, s);
        mesh.position.y = 0;
        mesh.rotation.y = Math.PI;

        mesh.castShadow = true;
        mesh.receiveShadow = true;

        scene.add(mesh);
        model = mesh;

        mixer = new three__WEBPACK_IMPORTED_MODULE_13__.AnimationMixer(mesh);
        mixer.clipAction(gltf.animations[0]).setDuration(1).play();
      },
      undefined,
      function (e) {
        console.error(e);
      }
    );

    renderer = new three__WEBPACK_IMPORTED_MODULE_13__.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputEncoding = three__WEBPACK_IMPORTED_MODULE_13__.sRGBEncoding;
    container.appendChild(renderer.domElement);

    //控制器
    controls = new three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_2__.OrbitControls(camera, renderer.domElement);

    window.addEventListener('resize', onWindowResize);
    stats = new three_examples_jsm_libs_stats_module_js__WEBPACK_IMPORTED_MODULE_5__.default();
    container.appendChild(stats.dom);
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function changeDirection(code) {
    model.rotation.x = directionObj[code][0];
    model.rotation.y = directionObj[code][1];
    model.rotation.z = directionObj[code][2];
  }

  function getDirection(dire) {
    if (faceTo !== dire && model) {
      // if (mixer) mixer.stop();
      changeDirection(dire);
    }
    faceTo = dire;
  }

  function getPosition(dire) {
    let length = dire.shift ? 2 : 1;
    let x = RobotPositon.x,
      height = RobotPositon.y,
      z = RobotPositon.z;
    if (direction.left) x -= length;
    if (direction.front) height += length * 0.5;
    if (direction.back) height -= length * 0.5;
    if (direction.right) x += length;

    if (noCollisionCheck(x, height, z) && !game_over) {
      alert('Game Over !');
      game_over = true;
      window.location.href = window.location.href;
    }
    x > 60 ? (x = 60) : null;
    x < -60 ? (x = -60) : null;
    height > 30 ? (height = 30) : null;
    height < -30 ? (height = -30) : null;
    RobotPositon.x = x;
    RobotPositon.y = height;
    RobotPositon.z = z;
  }

  function noCollisionCheck(x, height, z) {
    return boxList.concat(boneList).some((a) => {
      // 箱子
      let geo = a.geometry;
      if (
        x - 5 < a.position.x + geo.parameters.width / 2 &&
        x + 5 > a.position.x - geo.parameters.width / 2 &&
        height - 5 < a.position.y + geo.parameters.height / 2 &&
        height + 5 > a.position.y - geo.parameters.height / 2 &&
        z - 5 < a.position.z + geo.parameters.depth / 2 &&
        z + 5 > a.position.z - geo.parameters.depth / 2
      ) {
        scene.remove(a);
        return true;
      }
      return false;
    });
  }

  function groundMove() {
    groundList.forEach((a) => {
      a.position.z += speed;
      if (a.position.z >= 2000) a.position.z = -2000;
    });
    boxList.forEach((a) => {
      a.position.z += speed;
      if (a.position.z >= 1000) a.position.z = -1000;
    });
    boneList.forEach((a) => {
      a.position.z += speed * 3;
      if (a.position.z >= 1000) a.position.z = -1000;
    });
  }

  function animate() {
    fly_length++;
    fly_length_dom.innerText = '你飞行了' + fly_length + '米';
    speed = 1 + Math.ceil(fly_length / 50) / 10;
    speed > 10 ? (speed = 10) : null;
    let dire = direction.value();
    getDirection(dire);
    getPosition(direction);
    groundMove();
    model && model.position.set(RobotPositon.x, RobotPositon.y, RobotPositon.z);
    const dt = clock.getDelta();

    if (mixer) {
      mixer.update(dt);
    }

    requestAnimationFrame(animate);

    renderer.render(scene, camera);
    controls.update();
    stats.update();
  }
}

main();


/***/ }),

/***/ "./src/img/blue.jpg":
/*!**************************!*\
  !*** ./src/img/blue.jpg ***!
  \**************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "2653a365930a9fc6acf3.jpg";

/***/ }),

/***/ "./src/img/ground.jpg":
/*!****************************!*\
  !*** ./src/img/ground.jpg ***!
  \****************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "4c494f49784704c56d2f.jpg";

/***/ }),

/***/ "./src/img/sand.jpg":
/*!**************************!*\
  !*** ./src/img/sand.jpg ***!
  \**************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "ff95106bd3ebee210d86.jpg";

/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ __webpack_require__.O(0, ["vendors"], () => (__webpack_exec__("./src/index.js")));
/******/ var __webpack_exports__ = __webpack_require__.O();
/******/ }
]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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OEJBQThCLGdEQUFrQjtBQUNoRDs7QUFFQTtBQUNBLG1CQUFtQix1RkFBYTs7QUFFaEM7QUFDQSxnQkFBZ0IsNEVBQUs7QUFDckI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJwYWNrLWRlbW8vLi9zcmMvc3R5bGUuY3NzIiwid2VicGFjazovL3dlYnBhY2stZGVtby8uL3NyYy9GbGFtaW5nby5nbGIiLCJ3ZWJwYWNrOi8vd2VicGFjay1kZW1vLy4vc3JjL3N0eWxlLmNzcz83MTYzIiwid2VicGFjazovL3dlYnBhY2stZGVtby8uL3NyYy9jb21wb25lbnRzL2RpcmVjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJwYWNrLWRlbW8vLi9zcmMvY29tcG9uZW50cy91dGlsLmpzIiwid2VicGFjazovL3dlYnBhY2stZGVtby8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbXBvcnRzXG5pbXBvcnQgX19fQ1NTX0xPQURFUl9BUElfU09VUkNFTUFQX0lNUE9SVF9fXyBmcm9tIFwiLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL2Nzc1dpdGhNYXBwaW5nVG9TdHJpbmcuanNcIjtcbmltcG9ydCBfX19DU1NfTE9BREVSX0FQSV9JTVBPUlRfX18gZnJvbSBcIi4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIjtcbnZhciBfX19DU1NfTE9BREVSX0VYUE9SVF9fXyA9IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyhfX19DU1NfTE9BREVSX0FQSV9TT1VSQ0VNQVBfSU1QT1JUX19fKTtcbi8vIE1vZHVsZVxuX19fQ1NTX0xPQURFUl9FWFBPUlRfX18ucHVzaChbbW9kdWxlLmlkLCBcImh0bWwsXFxuYm9keSB7XFxuICBtYXJnaW46IDA7XFxuICBwYWRkaW5nOiAwO1xcbiAgaGVpZ2h0OiAxMDAlO1xcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcXG59XFxuY2FudmFzIHtcXG4gIHdpZHRoOiAxMDAlO1xcbiAgaGVpZ2h0OiAxMDAlO1xcbn1cXG4ubnVtYmVyIHtcXG4gIHBvc2l0aW9uOiBmaXhlZDtcXG4gIHRvcDogMTAlO1xcbiAgbGVmdDogNTAlO1xcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpO1xcbn1cXG4udGlwIHtcXG4gIHBvc2l0aW9uOiBmaXhlZDtcXG4gIGJvdHRvbTogMjBweDtcXG4gIGxlZnQ6IDIwcHg7XFxuICBjb2xvcjogIzMzMztcXG59XFxuXCIsIFwiXCIse1widmVyc2lvblwiOjMsXCJzb3VyY2VzXCI6W1wid2VicGFjazovLy4vc3JjL3N0eWxlLmNzc1wiXSxcIm5hbWVzXCI6W10sXCJtYXBwaW5nc1wiOlwiQUFBQTs7RUFFRSxTQUFTO0VBQ1QsVUFBVTtFQUNWLFlBQVk7RUFDWixnQkFBZ0I7QUFDbEI7QUFDQTtFQUNFLFdBQVc7RUFDWCxZQUFZO0FBQ2Q7QUFDQTtFQUNFLGVBQWU7RUFDZixRQUFRO0VBQ1IsU0FBUztFQUNULDJCQUEyQjtBQUM3QjtBQUNBO0VBQ0UsZUFBZTtFQUNmLFlBQVk7RUFDWixVQUFVO0VBQ1YsV0FBVztBQUNiXCIsXCJzb3VyY2VzQ29udGVudFwiOltcImh0bWwsXFxuYm9keSB7XFxuICBtYXJnaW46IDA7XFxuICBwYWRkaW5nOiAwO1xcbiAgaGVpZ2h0OiAxMDAlO1xcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcXG59XFxuY2FudmFzIHtcXG4gIHdpZHRoOiAxMDAlO1xcbiAgaGVpZ2h0OiAxMDAlO1xcbn1cXG4ubnVtYmVyIHtcXG4gIHBvc2l0aW9uOiBmaXhlZDtcXG4gIHRvcDogMTAlO1xcbiAgbGVmdDogNTAlO1xcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpO1xcbn1cXG4udGlwIHtcXG4gIHBvc2l0aW9uOiBmaXhlZDtcXG4gIGJvdHRvbTogMjBweDtcXG4gIGxlZnQ6IDIwcHg7XFxuICBjb2xvcjogIzMzMztcXG59XFxuXCJdLFwic291cmNlUm9vdFwiOlwiXCJ9XSk7XG4vLyBFeHBvcnRzXG5leHBvcnQgZGVmYXVsdCBfX19DU1NfTE9BREVSX0VYUE9SVF9fXztcbiIsImV4cG9ydCBkZWZhdWx0IF9fd2VicGFja19wdWJsaWNfcGF0aF9fICsgXCJlNjVjZjk0MzhlNDIxMGEwN2RjZDZkODQxZWUxZjQ1Ni5nbGJcIjsiLCJcbiAgICAgIGltcG9ydCBBUEkgZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIjtcbiAgICAgIGltcG9ydCBkb21BUEkgZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZURvbUFQSS5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydEZuIGZyb20gXCIhLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5zZXJ0QnlTZWxlY3Rvci5qc1wiO1xuICAgICAgaW1wb3J0IHNldEF0dHJpYnV0ZXMgZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXMuanNcIjtcbiAgICAgIGltcG9ydCBpbnNlcnRTdHlsZUVsZW1lbnQgZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRTdHlsZUVsZW1lbnQuanNcIjtcbiAgICAgIGltcG9ydCBzdHlsZVRhZ1RyYW5zZm9ybUZuIGZyb20gXCIhLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVUYWdUcmFuc2Zvcm0uanNcIjtcbiAgICAgIGltcG9ydCBjb250ZW50LCAqIGFzIG5hbWVkRXhwb3J0IGZyb20gXCIhIS4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vc3R5bGUuY3NzXCI7XG4gICAgICBcbiAgICAgIFxuXG52YXIgb3B0aW9ucyA9IHt9O1xuXG5vcHRpb25zLnN0eWxlVGFnVHJhbnNmb3JtID0gc3R5bGVUYWdUcmFuc2Zvcm1Gbjtcbm9wdGlvbnMuc2V0QXR0cmlidXRlcyA9IHNldEF0dHJpYnV0ZXM7XG5cbiAgICAgIG9wdGlvbnMuaW5zZXJ0ID0gaW5zZXJ0Rm4uYmluZChudWxsLCBcImhlYWRcIik7XG4gICAgXG5vcHRpb25zLmRvbUFQSSA9IGRvbUFQSTtcbm9wdGlvbnMuaW5zZXJ0U3R5bGVFbGVtZW50ID0gaW5zZXJ0U3R5bGVFbGVtZW50O1xuXG52YXIgdXBkYXRlID0gQVBJKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG5cblxuZXhwb3J0ICogZnJvbSBcIiEhLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanMhLi9zdHlsZS5jc3NcIjtcbiAgICAgICBleHBvcnQgZGVmYXVsdCBjb250ZW50ICYmIGNvbnRlbnQubG9jYWxzID8gY29udGVudC5sb2NhbHMgOiB1bmRlZmluZWQ7XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBEaXJlY3Rpb24oKSB7XG4gIGxldCBsYXN0S2V5ID0gbnVsbCxcbiAgICBsYXN0VXBUaW1lID0gMDtcbiAgbGV0IGRpcmVjdGlvbiA9IHtcbiAgICBsZWZ0OiBmYWxzZSxcbiAgICBmcm9udDogZmFsc2UsXG4gICAgYmFjazogZmFsc2UsXG4gICAgcmlnaHQ6IGZhbHNlLFxuICAgIHNoaWZ0OiBmYWxzZSxcbiAgICBkb3VibGVLZXk6ICcnLFxuICAgIHZhbHVlKCkge1xuICAgICAgaWYgKHRoaXMubGVmdCAmJiB0aGlzLmZyb250KSByZXR1cm4gJ0xlZnRGcm9udCc7XG4gICAgICBpZiAodGhpcy5sZWZ0ICYmIHRoaXMuYmFjaykgcmV0dXJuICdMZWZ0QmFjayc7XG4gICAgICBpZiAodGhpcy5yaWdodCAmJiB0aGlzLmZyb250KSByZXR1cm4gJ1JpZ2h0RnJvbnQnO1xuICAgICAgaWYgKHRoaXMucmlnaHQgJiYgdGhpcy5iYWNrKSByZXR1cm4gJ1JpZ2h0QmFjayc7XG4gICAgICBpZiAodGhpcy5sZWZ0KSByZXR1cm4gJ0xlZnQnO1xuICAgICAgaWYgKHRoaXMuZnJvbnQpIHJldHVybiAnRnJvbnQnO1xuICAgICAgaWYgKHRoaXMuYmFjaykgcmV0dXJuICdCYWNrJztcbiAgICAgIGlmICh0aGlzLnJpZ2h0KSByZXR1cm4gJ1JpZ2h0JztcbiAgICAgIHJldHVybiAnU3RvcCc7XG4gICAgfSxcbiAgfTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgaWYgKGxhc3RLZXkgPT09IGV2LmNvZGUgJiYgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBsYXN0VXBUaW1lIDwgMzAwKSB7XG4gICAgICBkaXJlY3Rpb24uZG91YmxlS2V5ID0gZXYuY29kZTtcbiAgICB9XG4gICAgc3dpdGNoIChldi5jb2RlKSB7XG4gICAgICBjYXNlICdLZXlBJzpcbiAgICAgICAgZGlyZWN0aW9uLmxlZnQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0tleVcnOlxuICAgICAgICBkaXJlY3Rpb24uZnJvbnQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0tleUQnOlxuICAgICAgICBkaXJlY3Rpb24ucmlnaHQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0tleVMnOlxuICAgICAgICBkaXJlY3Rpb24uYmFjayA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnU2hpZnRMZWZ0JzpcbiAgICAgICAgZGlyZWN0aW9uLnNoaWZ0ID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9KTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIChldikge1xuICAgIGlmIChkaXJlY3Rpb24uZG91YmxlS2V5ID09PSBldi5jb2RlKSBkaXJlY3Rpb24uZG91YmxlS2V5ID0gJyc7XG4gICAgbGFzdEtleSA9IGV2LmNvZGU7XG4gICAgbGFzdFVwVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIHN3aXRjaCAoZXYuY29kZSkge1xuICAgICAgY2FzZSAnS2V5QSc6XG4gICAgICAgIGRpcmVjdGlvbi5sZWZ0ID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnS2V5Vyc6XG4gICAgICAgIGRpcmVjdGlvbi5mcm9udCA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0tleUQnOlxuICAgICAgICBkaXJlY3Rpb24ucmlnaHQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdLZXlTJzpcbiAgICAgICAgZGlyZWN0aW9uLmJhY2sgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdTaGlmdExlZnQnOlxuICAgICAgICBkaXJlY3Rpb24uc2hpZnQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG5cbiAgcmV0dXJuIGRpcmVjdGlvbjtcbn1cbiIsImZ1bmN0aW9uIGdldFJhbmRvbShudW0xLCBudW0yKSB7XG4gIGxldCBudW0gPSBudW0yIC0gbnVtMTtcbiAgcmV0dXJuIG51bTEgKyBNYXRoLnJvdW5kKG51bSAqIE1hdGgucmFuZG9tKCkpO1xufVxuZXhwb3J0IHsgZ2V0UmFuZG9tIH07XG4iLCJpbXBvcnQgXywgeyBmdW5jdGlvbnNJbiB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7XG5pbXBvcnQgJy4vc3R5bGUuY3NzJztcbmltcG9ydCB7IE9yYml0Q29udHJvbHMgfSBmcm9tICd0aHJlZS9leGFtcGxlcy9qc20vY29udHJvbHMvT3JiaXRDb250cm9scy5qcyc7XG5pbXBvcnQgeyBQb2ludGVyTG9ja0NvbnRyb2xzIH0gZnJvbSAndGhyZWUvZXhhbXBsZXMvanNtL2NvbnRyb2xzL1BvaW50ZXJMb2NrQ29udHJvbHMuanMnO1xuaW1wb3J0IHsgR1VJIH0gZnJvbSAnZGF0Lmd1aSc7XG5pbXBvcnQgU3RhdHMgZnJvbSAndGhyZWUvZXhhbXBsZXMvanNtL2xpYnMvc3RhdHMubW9kdWxlLmpzJztcbmltcG9ydCBDcmFuZSBmcm9tICcuL0ZsYW1pbmdvLmdsYic7XG5pbXBvcnQgeyBHTFRGTG9hZGVyIH0gZnJvbSAndGhyZWUvZXhhbXBsZXMvanNtL2xvYWRlcnMvR0xURkxvYWRlci5qcyc7XG5pbXBvcnQgRGlyZWN0aW9uIGZyb20gJy4vY29tcG9uZW50cy9kaXJlY3Rpb24nO1xuaW1wb3J0IGdyb3VuZEltZyBmcm9tICcuL2ltZy9ncm91bmQuanBnJztcbmltcG9ydCBibHVlSW1nIGZyb20gJy4vaW1nL2JsdWUuanBnJztcbmltcG9ydCBzYW5kSW1nIGZyb20gJy4vaW1nL3NhbmQuanBnJztcbmltcG9ydCB7IGdldFJhbmRvbSB9IGZyb20gJy4vY29tcG9uZW50cy91dGlsJztcblxuZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc3QgdGV4dHVyZUxvYWRlciA9IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCk7IC8v5Zu+54mH5riy5p+T5ZmoXG4gIGNvbnN0IG9ic3RhY2xlID0gW107IC8v6Zqc56KN54mp5YiX6KGoXG4gIGxldCBkaXJlY3Rpb24gPSBEaXJlY3Rpb24oKTsgLy/mlrnlkJFcbiAgbGV0IGNvbnRhaW5lciwgLy9kaXblrrnlmahcbiAgICBjb250cm9scywgLy9kaXblrrnlmahcbiAgICBzdGF0cywgLy9mcHPmjIfnpLrlmahcbiAgICBjbG9jaywgLy/ml7bpkp9cbiAgICBtaXhlciwgLy/liqjnlLvmt7flkIjlmahcbiAgICBhY3Rpb25zLCAvL+ihjOS4ulxuICAgIGFjdGl2ZUFjdGlvbiwgLy/mtLvliqjkuK3ooYzkuLpcbiAgICBwcmV2aW91c0FjdGlvbjsgLy/kuIrkuIDkuKrooYzkuLpcbiAgbGV0IGNhbWVyYSwgLy/nm7jmnLpcbiAgICBzY2VuZSwgLy8g5Zy65pmvXG4gICAgcmVuZGVyZXIsIC8vIOa4suafk+WZqFxuICAgIG1vZGVsLCAvLyDmnLrlmajkurrmqKHlnZdcbiAgICBncm91bmRMaXN0ID0gW10sXG4gICAgYm94TGlzdCA9IFtdLFxuICAgIGJvbmVMaXN0ID0gW10sXG4gICAgc3BlZWQgPSAxLFxuICAgIGZseV9sZW5ndGggPSAwLFxuICAgIGZseV9sZW5ndGhfZG9tID0gMCxcbiAgICBnYW1lX292ZXIgPSBmYWxzZTtcblxuICBjb25zdCBkaXJlY3Rpb25PYmogPSB7XG4gICAgTGVmdDogWzAsIChNYXRoLlBJICogNSkgLyA0LCAtTWF0aC5QSSAvIDRdLFxuICAgIExlZnRCYWNrOiBbLU1hdGguUEkgLyA4LCAoTWF0aC5QSSAqIDUpIC8gNCwgLU1hdGguUEkgLyA0XSxcbiAgICBCYWNrOiBbLU1hdGguUEkgLyA4LCBNYXRoLlBJLCAwXSxcbiAgICBSaWdodEJhY2s6IFstTWF0aC5QSSAvIDgsIChNYXRoLlBJICogMykgLyA0LCBNYXRoLlBJIC8gNF0sXG4gICAgUmlnaHQ6IFswLCAoTWF0aC5QSSAqIDMpIC8gNCwgTWF0aC5QSSAvIDRdLFxuICAgIFJpZ2h0RnJvbnQ6IFtNYXRoLlBJIC8gOCwgKE1hdGguUEkgKiAzKSAvIDQsIE1hdGguUEkgLyA0XSxcbiAgICBGcm9udDogW01hdGguUEkgLyA4LCBNYXRoLlBJLCAwXSxcbiAgICBMZWZ0RnJvbnQ6IFtNYXRoLlBJIC8gOCwgKE1hdGguUEkgKiA1KSAvIDQsIC1NYXRoLlBJIC8gNF0sXG4gICAgU3RvcDogWzAsIE1hdGguUEksIDBdLFxuICB9O1xuICBsZXQgUm9ib3RQb3NpdG9uID0geyB4OiAwLCB5OiAwLCB6OiAwIH07XG5cbiAgbGV0IGZhY2VUbyA9ICdTdG9wJztcblxuICBpbml0KCk7XG4gIGFuaW1hdGUoKTtcblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8v5Yib5bu6ZGl2XG4gICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuXG4gICAgLy/lsZXnpLrpo57ooYzot53nprtcbiAgICBmbHlfbGVuZ3RoX2RvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGZseV9sZW5ndGhfZG9tLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnbnVtYmVyJyk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZseV9sZW5ndGhfZG9tKTtcblxuICAgIC8v5o+Q56S6XG4gICAgY29uc3Qgb3BlcmF0aW9uX3RpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIG9wZXJhdGlvbl90aXAuc2V0QXR0cmlidXRlKCdjbGFzcycsICd0aXAnKTtcbiAgICBvcGVyYXRpb25fdGlwLmlubmVyVGV4dCA9ICfmj5DnpLrvvJpcIldcIixcIkFcIixcIlNcIixcIkRcIiDlj6/mk43kvZzmlrnlkJEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChvcGVyYXRpb25fdGlwKTtcblxuICAgIC8v5Yib5bu655u45py6XG4gICAgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxuICAgICAgNDUsXG4gICAgICB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICAgIDAuMjUsXG4gICAgICAxMDAwXG4gICAgKTtcbiAgICBjYW1lcmEucG9zaXRpb24uc2V0KDAsIDUwLCAxMDApO1xuICAgIGNhbWVyYS5sb29rQXQobmV3IFRIUkVFLlZlY3RvcjMoMCwgMzAwLCAwKSk7XG5cbiAgICAvL+WIm+W7uuWcuuaZr1xuICAgIHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgc2NlbmUuYmFja2dyb3VuZCA9IG5ldyBUSFJFRS5Db2xvcigweGUwZTBlMCk7XG4gICAgLy/liJvlu7rpm75cbiAgICBzY2VuZS5mb2cgPSBuZXcgVEhSRUUuRm9nKDB4ZTBlMGUwLCAxMCwgODAwKTtcbiAgICAvL+aXtumXtFxuICAgIGNsb2NrID0gbmV3IFRIUkVFLkNsb2NrKCk7XG5cbiAgICAvL+WkqeepuuWcsOmdouWFiVxuICAgIGNvbnN0IGhlbWlMaWdodCA9IG5ldyBUSFJFRS5IZW1pc3BoZXJlTGlnaHQoMHhmZmZmZmYsIDB4OTFkNWZmLCAxKTtcbiAgICBzY2VuZS5hZGQoaGVtaUxpZ2h0KTtcblxuICAgIC8v5pa55ZCR5YWJXG4gICAgY29uc3QgZGlyTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZik7XG4gICAgZGlyTGlnaHQucG9zaXRpb24uc2V0KDAsIDIwMCwgMTAwKTtcbiAgICBzY2VuZS5hZGQoZGlyTGlnaHQpO1xuXG4gICAgLy8gZ3JvdW5kXG5cbiAgICBjb25zdCBncm91bmRUZXh0dXJlID0gdGV4dHVyZUxvYWRlci5sb2FkKGdyb3VuZEltZyk7XG5cbiAgICBncm91bmRUZXh0dXJlLndyYXBTID0gVEhSRUUuTWlycm9yZWRSZXBlYXRXcmFwcGluZztcbiAgICBncm91bmRUZXh0dXJlLndyYXBUID0gVEhSRUUuTWlycm9yZWRSZXBlYXRXcmFwcGluZztcbiAgICBncm91bmRUZXh0dXJlLnJlcGVhdC5zZXQoMywgNyk7XG5cbiAgICBjb25zdCBncm91bmRfbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7XG4gICAgICBtYXA6IGdyb3VuZFRleHR1cmUsXG4gICAgICBjb2xvcjogMHgwMDUwYjMsXG4gICAgfSk7XG5cbiAgICBjb25zdCBibHVlX21hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoe1xuICAgICAgbWFwOiB0ZXh0dXJlTG9hZGVyLmxvYWQoYmx1ZUltZyksXG4gICAgICBjb2xvcjogMHgwMDUwYjMsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzYW5kX21hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoe1xuICAgICAgbWFwOiB0ZXh0dXJlTG9hZGVyLmxvYWQoc2FuZEltZyksXG4gICAgfSk7XG5cbiAgICBncm91bmRMaXN0LnB1c2gobmV3Qm94KDIwMDAsIDEsIDIwMDAsIGdyb3VuZF9tYXRlcmlhbCwgMCwgLTEwMCwgLTEwKSk7XG4gICAgZ3JvdW5kTGlzdC5wdXNoKG5ld0JveCgyMDAwLCAxLCAyMDAwLCBncm91bmRfbWF0ZXJpYWwsIDAsIC0xMDAsIC0yMDEwKSk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHtcbiAgICAgIGJveExpc3QucHVzaChcbiAgICAgICAgbmV3Qm94KFxuICAgICAgICAgIDEwLFxuICAgICAgICAgIDEwLFxuICAgICAgICAgIDEwLFxuICAgICAgICAgIGJsdWVfbWF0ZXJpYWwsXG4gICAgICAgICAgZ2V0UmFuZG9tKC02MCwgNjApLFxuICAgICAgICAgIGdldFJhbmRvbSgtMzAsIDMwKSxcbiAgICAgICAgICAxMDAwIC0gMTAwICogaSAtIE1hdGgucmFuZG9tKDAsIDEwMClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGJvbmVMaXN0LnB1c2goXG4gICAgICAgIG5ld0JveChcbiAgICAgICAgICAxMCxcbiAgICAgICAgICAxMCxcbiAgICAgICAgICAxMCxcbiAgICAgICAgICBzYW5kX21hdGVyaWFsLFxuICAgICAgICAgIGdldFJhbmRvbSgtNjAsIDYwKSxcbiAgICAgICAgICBnZXRSYW5kb20oLTMwLCAzMCksXG4gICAgICAgICAgMTAwMCAtIDIwMCAqIGkgLSBNYXRoLnJhbmRvbSgwLCAxMDApXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmV3Qm94KHdpZHRoLCBoZWlnaHQsIGxlbmd0aCwgbWF0ZXJpYWwsIHgsIHksIHopIHtcbiAgICAgIGNvbnN0IGJveCA9IG5ldyBUSFJFRS5NZXNoKFxuICAgICAgICBuZXcgVEhSRUUuQm94R2VvbWV0cnkod2lkdGgsIGhlaWdodCwgbGVuZ3RoKSxcbiAgICAgICAgbWF0ZXJpYWxcbiAgICAgICk7XG4gICAgICBib3gucG9zaXRpb24uc2V0KHgsIHksIHopO1xuICAgICAgc2NlbmUuYWRkKGJveCk7XG4gICAgICBvYnN0YWNsZS5wdXNoKGJveCk7XG4gICAgICByZXR1cm4gYm94O1xuICAgIH1cblxuICAgIGNvbnN0IGxvYWRlciA9IG5ldyBHTFRGTG9hZGVyKCk7XG5cbiAgICBsb2FkZXIubG9hZChcbiAgICAgIENyYW5lLFxuICAgICAgZnVuY3Rpb24gKGdsdGYpIHtcbiAgICAgICAgY29uc3QgbWVzaCA9IGdsdGYuc2NlbmUuY2hpbGRyZW5bMF07XG5cbiAgICAgICAgY29uc3QgcyA9IDAuMTtcbiAgICAgICAgbWVzaC5zY2FsZS5zZXQocywgcywgcyk7XG4gICAgICAgIG1lc2gucG9zaXRpb24ueSA9IDA7XG4gICAgICAgIG1lc2gucm90YXRpb24ueSA9IE1hdGguUEk7XG5cbiAgICAgICAgbWVzaC5jYXN0U2hhZG93ID0gdHJ1ZTtcbiAgICAgICAgbWVzaC5yZWNlaXZlU2hhZG93ID0gdHJ1ZTtcblxuICAgICAgICBzY2VuZS5hZGQobWVzaCk7XG4gICAgICAgIG1vZGVsID0gbWVzaDtcblxuICAgICAgICBtaXhlciA9IG5ldyBUSFJFRS5BbmltYXRpb25NaXhlcihtZXNoKTtcbiAgICAgICAgbWl4ZXIuY2xpcEFjdGlvbihnbHRmLmFuaW1hdGlvbnNbMF0pLnNldER1cmF0aW9uKDEpLnBsYXkoKTtcbiAgICAgIH0sXG4gICAgICB1bmRlZmluZWQsXG4gICAgICBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgfVxuICAgICk7XG5cbiAgICByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHsgYW50aWFsaWFzOiB0cnVlIH0pO1xuICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgIHJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gICAgcmVuZGVyZXIub3V0cHV0RW5jb2RpbmcgPSBUSFJFRS5zUkdCRW5jb2Rpbmc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuXG4gICAgLy/mjqfliLblmahcbiAgICBjb250cm9scyA9IG5ldyBPcmJpdENvbnRyb2xzKGNhbWVyYSwgcmVuZGVyZXIuZG9tRWxlbWVudCk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUpO1xuICAgIHN0YXRzID0gbmV3IFN0YXRzKCk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHN0YXRzLmRvbSk7XG4gIH1cblxuICBmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZSgpIHtcbiAgICBjYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcblxuICAgIHJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGFuZ2VEaXJlY3Rpb24oY29kZSkge1xuICAgIG1vZGVsLnJvdGF0aW9uLnggPSBkaXJlY3Rpb25PYmpbY29kZV1bMF07XG4gICAgbW9kZWwucm90YXRpb24ueSA9IGRpcmVjdGlvbk9ialtjb2RlXVsxXTtcbiAgICBtb2RlbC5yb3RhdGlvbi56ID0gZGlyZWN0aW9uT2JqW2NvZGVdWzJdO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RGlyZWN0aW9uKGRpcmUpIHtcbiAgICBpZiAoZmFjZVRvICE9PSBkaXJlICYmIG1vZGVsKSB7XG4gICAgICAvLyBpZiAobWl4ZXIpIG1peGVyLnN0b3AoKTtcbiAgICAgIGNoYW5nZURpcmVjdGlvbihkaXJlKTtcbiAgICB9XG4gICAgZmFjZVRvID0gZGlyZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFBvc2l0aW9uKGRpcmUpIHtcbiAgICBsZXQgbGVuZ3RoID0gZGlyZS5zaGlmdCA/IDIgOiAxO1xuICAgIGxldCB4ID0gUm9ib3RQb3NpdG9uLngsXG4gICAgICBoZWlnaHQgPSBSb2JvdFBvc2l0b24ueSxcbiAgICAgIHogPSBSb2JvdFBvc2l0b24uejtcbiAgICBpZiAoZGlyZWN0aW9uLmxlZnQpIHggLT0gbGVuZ3RoO1xuICAgIGlmIChkaXJlY3Rpb24uZnJvbnQpIGhlaWdodCArPSBsZW5ndGggKiAwLjU7XG4gICAgaWYgKGRpcmVjdGlvbi5iYWNrKSBoZWlnaHQgLT0gbGVuZ3RoICogMC41O1xuICAgIGlmIChkaXJlY3Rpb24ucmlnaHQpIHggKz0gbGVuZ3RoO1xuXG4gICAgaWYgKG5vQ29sbGlzaW9uQ2hlY2soeCwgaGVpZ2h0LCB6KSAmJiAhZ2FtZV9vdmVyKSB7XG4gICAgICBhbGVydCgnR2FtZSBPdmVyICEnKTtcbiAgICAgIGdhbWVfb3ZlciA9IHRydWU7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgIH1cbiAgICB4ID4gNjAgPyAoeCA9IDYwKSA6IG51bGw7XG4gICAgeCA8IC02MCA/ICh4ID0gLTYwKSA6IG51bGw7XG4gICAgaGVpZ2h0ID4gMzAgPyAoaGVpZ2h0ID0gMzApIDogbnVsbDtcbiAgICBoZWlnaHQgPCAtMzAgPyAoaGVpZ2h0ID0gLTMwKSA6IG51bGw7XG4gICAgUm9ib3RQb3NpdG9uLnggPSB4O1xuICAgIFJvYm90UG9zaXRvbi55ID0gaGVpZ2h0O1xuICAgIFJvYm90UG9zaXRvbi56ID0gejtcbiAgfVxuXG4gIGZ1bmN0aW9uIG5vQ29sbGlzaW9uQ2hlY2soeCwgaGVpZ2h0LCB6KSB7XG4gICAgcmV0dXJuIGJveExpc3QuY29uY2F0KGJvbmVMaXN0KS5zb21lKChhKSA9PiB7XG4gICAgICAvLyDnrrHlrZBcbiAgICAgIGxldCBnZW8gPSBhLmdlb21ldHJ5O1xuICAgICAgaWYgKFxuICAgICAgICB4IC0gNSA8IGEucG9zaXRpb24ueCArIGdlby5wYXJhbWV0ZXJzLndpZHRoIC8gMiAmJlxuICAgICAgICB4ICsgNSA+IGEucG9zaXRpb24ueCAtIGdlby5wYXJhbWV0ZXJzLndpZHRoIC8gMiAmJlxuICAgICAgICBoZWlnaHQgLSA1IDwgYS5wb3NpdGlvbi55ICsgZ2VvLnBhcmFtZXRlcnMuaGVpZ2h0IC8gMiAmJlxuICAgICAgICBoZWlnaHQgKyA1ID4gYS5wb3NpdGlvbi55IC0gZ2VvLnBhcmFtZXRlcnMuaGVpZ2h0IC8gMiAmJlxuICAgICAgICB6IC0gNSA8IGEucG9zaXRpb24ueiArIGdlby5wYXJhbWV0ZXJzLmRlcHRoIC8gMiAmJlxuICAgICAgICB6ICsgNSA+IGEucG9zaXRpb24ueiAtIGdlby5wYXJhbWV0ZXJzLmRlcHRoIC8gMlxuICAgICAgKSB7XG4gICAgICAgIHNjZW5lLnJlbW92ZShhKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBncm91bmRNb3ZlKCkge1xuICAgIGdyb3VuZExpc3QuZm9yRWFjaCgoYSkgPT4ge1xuICAgICAgYS5wb3NpdGlvbi56ICs9IHNwZWVkO1xuICAgICAgaWYgKGEucG9zaXRpb24ueiA+PSAyMDAwKSBhLnBvc2l0aW9uLnogPSAtMjAwMDtcbiAgICB9KTtcbiAgICBib3hMaXN0LmZvckVhY2goKGEpID0+IHtcbiAgICAgIGEucG9zaXRpb24ueiArPSBzcGVlZDtcbiAgICAgIGlmIChhLnBvc2l0aW9uLnogPj0gMTAwMCkgYS5wb3NpdGlvbi56ID0gLTEwMDA7XG4gICAgfSk7XG4gICAgYm9uZUxpc3QuZm9yRWFjaCgoYSkgPT4ge1xuICAgICAgYS5wb3NpdGlvbi56ICs9IHNwZWVkICogMztcbiAgICAgIGlmIChhLnBvc2l0aW9uLnogPj0gMTAwMCkgYS5wb3NpdGlvbi56ID0gLTEwMDA7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBhbmltYXRlKCkge1xuICAgIGZseV9sZW5ndGgrKztcbiAgICBmbHlfbGVuZ3RoX2RvbS5pbm5lclRleHQgPSAn5L2g6aOe6KGM5LqGJyArIGZseV9sZW5ndGggKyAn57GzJztcbiAgICBzcGVlZCA9IDEgKyBNYXRoLmNlaWwoZmx5X2xlbmd0aCAvIDUwKSAvIDEwO1xuICAgIHNwZWVkID4gMTAgPyAoc3BlZWQgPSAxMCkgOiBudWxsO1xuICAgIGxldCBkaXJlID0gZGlyZWN0aW9uLnZhbHVlKCk7XG4gICAgZ2V0RGlyZWN0aW9uKGRpcmUpO1xuICAgIGdldFBvc2l0aW9uKGRpcmVjdGlvbik7XG4gICAgZ3JvdW5kTW92ZSgpO1xuICAgIG1vZGVsICYmIG1vZGVsLnBvc2l0aW9uLnNldChSb2JvdFBvc2l0b24ueCwgUm9ib3RQb3NpdG9uLnksIFJvYm90UG9zaXRvbi56KTtcbiAgICBjb25zdCBkdCA9IGNsb2NrLmdldERlbHRhKCk7XG5cbiAgICBpZiAobWl4ZXIpIHtcbiAgICAgIG1peGVyLnVwZGF0ZShkdCk7XG4gICAgfVxuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xuXG4gICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmEpO1xuICAgIGNvbnRyb2xzLnVwZGF0ZSgpO1xuICAgIHN0YXRzLnVwZGF0ZSgpO1xuICB9XG59XG5cbm1haW4oKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==